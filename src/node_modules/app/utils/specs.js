import * as _ from 'lamb';
import {makePostfixed, applyFnMap} from '@svizzle/utils';

export const getSource = _.getKey('source');
export const getVersion = _.getKey('version');
export const getSchema = _.getPath('spec.dataset.schema');
export const getEndpointURL = _.getPath('spec.dataset.endpoint_url');
export const getSearchURL = _.pipe([getEndpointURL, makePostfixed('/_search')]);

export const groupBySource = _.groupBy(getSource);

export const makeDatasetBySource = _.pipe([
	_.groupBy(getSource),
	_.mapValuesWith(_.sortWith([_.getKey('project'), getVersion])),
	_.values,
	_.sortWith([getSource]),
	_.mapWith(applyFnMap({
		source: _.getPath('0.source'),
		releases: _.sortWith([getVersion])
	}))
]);
